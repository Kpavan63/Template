<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CineMagic - Your Ultimate Movie Destination</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/swiper@9/swiper-bundle.min.css">
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>

    <style>
        @import url('https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600;700&display=swap');

:root {
    --primary-color: #ff4081;
    --secondary-color: #3f51b5;
    --background-color: #121212;
    --text-color: #ffffff;
}

* {
    margin: 0;
    padding: 0;
    box-sizing: border-box;
}

body {
    font-family: 'Poppins', sans-serif;
    background-color: var(--background-color);
    color: var(--text-color);
    overflow-x: hidden;
}

#vanta-background {
    position: fixed;
    width: 100%;
    height: 100%;
    z-index: -1;
}

.container {
    max-width: 1200px;
    margin: 0 auto;
    padding: 20px;
}

.navbar {
    position: fixed;
    top: 0;
    left: 0;
    right: 0;
    z-index: 1000;
    background: rgba(0, 0, 0, 0.8);
    backdrop-filter: blur(10px);
    padding: 15px 0;
}

.navbar-content {
    display: flex;
    justify-content: space-between;
    align-items: center;
    max-width: 1200px;
    margin: 0 auto;
    padding: 0 20px;
}

.logo {
    font-size: 24px;
    font-weight: bold;
    color: #fff;
    text-decoration: none;
    text-transform: uppercase;
    letter-spacing: 2px;
}

.nav-links {
    display: flex;
    gap: 20px;
}

.nav-links a {
    color: #fff;
    text-decoration: none;
    font-weight: 500;
    transition: color 0.3s ease;
}

.nav-links a:hover {
    color: var(--primary-color);
}

.title {
    text-align: center;
    font-size: 3rem;
    margin: 100px 0 2rem;
    text-shadow: 0 0 10px rgba(255, 255, 255, 0.5);
}

.swiper-container {
    width: 100%;
    padding-top: 50px;
    padding-bottom: 50px;
    overflow: hidden;
    visibility: hidden;
}

.swiper-container.swiper-initialized {
    visibility: visible;
}

.swiper-slide {
    background-position: center;
    background-size: cover;
    width: 300px;
    height: 450px;
    border-radius: 10px;
    box-shadow: 0 0 20px rgba(255, 255, 255, 0.3);
    transition: transform 0.3s ease;
    overflow: hidden;
}

.swiper-slide:hover {
    transform: scale(1.05);
}

.swiper-slide-active {
    transform: scale(1.1);
}

.movie-info {
    position: absolute;
    bottom: 0;
    left: 0;
    right: 0;
    padding: 20px;
    background: rgba(0, 0, 0, 0.7);
    color: #fff;
    transition: transform 0.3s ease;
    transform: translateY(100%);
}

.swiper-slide:hover .movie-info {
    transform: translateY(0);
}

.movie-title {
    font-size: 1.2rem;
    margin-bottom: 5px;
    font-weight: bold;
}

.movie-rating {
    font-size: 1rem;
    color: #ffd700;
    margin-bottom: 10px;
}

.swiper-button-next, .swiper-button-prev {
    color: #fff;
}

.swiper-pagination-bullet {
    background: #fff;
    opacity: 0.5;
}

.swiper-pagination-bullet-active {
    opacity: 1;
}

.movie-button {
    display: inline-block;
    padding: 10px 20px;
    background: linear-gradient(45deg, var(--primary-color), var(--secondary-color));
    border: none;
    border-radius: 25px;
    color: #fff;
    font-size: 14px;
    font-weight: bold;
    text-transform: uppercase;
    letter-spacing: 1px;
    cursor: pointer;
    transition: all 0.3s ease;
    overflow: hidden;
    position: relative;
}

.movie-button:hover {
    transform: translateY(-3px);
    box-shadow: 0 5px 15px rgba(255, 64, 129, 0.4);
}

.movie-button::before {
    content: '';
    position: absolute;
    top: 0;
    left: -100%;
    width: 100%;
    height: 100%;
    background: linear-gradient(
        120deg,
        transparent,
        rgba(255, 255, 255, 0.3),
        transparent
    );
    transition: all 0.4s ease;
}

.movie-button:hover::before {
    left: 100%;
}

.mobile-menu-toggle {
    display: none;
    background: none;
    border: none;
    cursor: pointer;
    padding: 0;
    width: 30px;
    height: 20px;
    position: relative;
    z-index: 1001;
}

.mobile-menu-toggle span {
    display: block;
    width: 100%;
    height: 2px;
    background-color: #fff;
    margin-bottom: 5px;
    transition: all 0.3s ease;
}

.mobile-menu-toggle.active span:nth-child(1) {
    transform: translateY(7px) rotate(45deg);
}

.mobile-menu-toggle.active span:nth-child(2) {
    opacity: 0;
}

.mobile-menu-toggle.active span:nth-child(3) {
    transform: translateY(-7px) rotate(-45deg);
}

.mobile-menu {
    position: fixed;
    top: 0;
    right: -100%;
    width: 80%;
    max-width: 300px;
    height: 100vh;
    background: rgba(0, 0, 0, 0.9);
    backdrop-filter: blur(10px);
    z-index: 1000;
    display: flex;
    flex-direction: column;
    justify-content: center;
    align-items: center;
    transition: right 0.3s ease;
}

.mobile-menu.active {
    right: 0;
}

.mobile-menu a {
    color: #fff;
    text-decoration: none;
    font-size: 24px;
    margin: 20px 0;
    transition: color 0.3s ease;
}

.mobile-menu a:hover {
    color: var(--primary-color);
}

.modal {
    display: none;
    position: fixed;
    z-index: 2000;
    left: 0;
    top: 0;
    width: 100%;
    height: 100%;
    overflow: auto;
    background-color: rgba(0, 0, 0, 0.8);
    backdrop-filter: blur(5px);
}

/* General modal styling */
.modal-content {
    display: flex;
    flex-wrap: nowrap; /* Ensure content stays in a single row */
    gap: 20px;         /* Add space between image and details */
    padding: 20px;
    background: linear-gradient(145deg, #121212, #1f1f1f);
    color: #fff;
    border-radius: 10px;
    box-shadow: 0 8px 24px rgba(0, 0, 0, 0.6);
    max-width: 80%;    /* Limit the popup width */
    margin: auto;
}

/* Image section */
.modal-img {
    flex: 1;           /* Take up 1 part of the available space */
    max-width: 40%;    /* Limit the image width */
}

.modal-img img {
    width: 100%;
    height: auto;
    border-radius: 10px;
    box-shadow: 0 4px 16px rgba(0, 0, 0, 0.5);
}

/* Details section */
.modal-details {
    flex: 2;           /* Take up 2 parts of the available space */
    display: flex;
    flex-direction: column;
    gap: 15px;         /* Space between details */
}

/* Responsive for Mobile */
@media (max-width: 768px) {
    .modal-content {
        flex-direction: column; /* Stack image and details vertically */
        gap: 10px;
        max-width: 95%;         /* Adjust width for mobile */
    }

    .modal-img {
        display: none;          /* Hide image on mobile */
    }
}



.close-button {
    color: #aaa;
    float: right;
    font-size: 28px;
    font-weight: bold;
    cursor: pointer;
}

.close-button:hover,
.close-button:focus {
    color: #fff;
    text-decoration: none;
    cursor: pointer;
}

.movie-section {
    margin-bottom: 50px;
}

.movie-grid {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
    gap: 20px;
}

.movie-card {
    background: rgba(255, 255, 255, 0.1);
    border-radius: 10px;
    overflow: hidden;
    height: 395px;
    transition: transform 0.3s ease;
    cursor: pointer;
}

.movie-card:hover {
    transform: translateY(-5px);
}

.movie-card img {
    width: 100%;
    height: 300px;
    object-fit: cover;
}
@media (max-width: 768px) {
    .movie-card {
        height: 398px; /* Adjust height for smaller screens */
    }
}

.movie-card-info {
    padding: 10px;
}

.movie-card-title {
    font-size: 1rem;
    color: #fff;
    margin-bottom: 5px;
}

.movie-card-rating {
    font-size: 0.9rem;
    color: #ffd700;
}

#search-container {
    display: flex;
    justify-content: center;
    margin-bottom: 20px;
}

#search-input {
    width: 300px;
    padding: 10px;
    border: none;
    border-radius: 25px;
    background-color: rgba(255, 255, 255, 0.1);
    color: #fff;
    font-size: 16px;
}

#search-input::placeholder {
    color: rgba(255, 255, 255, 0.5);
}

#search-button {
    background-color: var(--primary-color);
    color: #fff;
    border: none;
    border-radius: 25px;
    padding: 10px 20px;
    margin-left: 10px;
    cursor: pointer;
    transition: background-color 0.3s ease;
}

#search-button:hover {
    background-color: var(--secondary-color);
}

#newsletter-form {
    background-color: rgba(255, 255, 255, 0.1);
    padding: 20px;
    border-radius: 10px;
    margin-top: 40px;
}

#newsletter-form h3 {
    margin-bottom: 10px;
}

#newsletter-form input[type="email"] {
    width: 100%;
    padding: 10px;
    margin-bottom: 10px;
    border: none;
    border-radius: 5px;
}

#newsletter-form button {
    background-color: var(--primary-color);
    color: #fff;
    border: none;
    border-radius: 5px;
    padding: 10px 20px;
    cursor: pointer;
    transition: background-color 0.3s ease;
}

#newsletter-form button:hover {
    background-color: var(--secondary-color);
}

footer {
    background-color: rgba(0, 0, 0, 0.8);
    padding: 20px 0;
    margin-top: 40px;
    text-align: center;
}

.social-icons {
    margin-bottom: 10px;
}

.social-icons a {
    color: #fff;
    font-size: 24px;
    margin: 0 10px;
    transition: color 0.3s ease;
}

.social-icons a:hover {
    color: var(--primary-color);
}

.footer-links a {
    color: #fff;
    text-decoration: none;
    margin: 0 10px;
    transition: color 0.3s ease;
}

.footer-links a:hover {
    color: var(--primary-color);
}

@media (max-width: 768px) {
    .nav-links {
        display: none;
    }

    .mobile-menu-toggle {
        display: block;
    }

    .navbar-content {
        justify-content: space-between;
    }

    .swiper-slide {
        width: 250px;
        height: 375px;
    }

    .title {
        font-size: 2rem;
    }

    .movie-grid {
        grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
    }

    #search-container {
        flex-direction: column;
        align-items: center;
    }

    #search-input {
        width: 100%;
        margin-bottom: 10px;
    }

    #search-button {
        width: 100%;
        margin-left: 0;
    }
}

    </style>
</head>
<body>
    <div id="vanta-background"></div>
    <nav class="navbar">
        <div class="navbar-content">
            <a href="#" class="logo">i1cinema</a>
            <div class="nav-links">
                <a href="#current-movies">Current Movies</a>
                <a href="#upcoming-movies">Upcoming Movies</a>
                <a href="#top-rated">Top Rated</a>
                <a href="#newsletter">Newsletter</a>
            </div>
            <button class="mobile-menu-toggle">
                <span></span>
                <span></span>
                <span></span>
            </button>
        </div>
    </nav>
    <div class="mobile-menu">
        <a href="#current-movies">Current Movies</a>
        <a href="#upcoming-movies">Upcoming Movies</a>
        <a href="#top-rated">Top Rated</a>
        <a href="#newsletter">Newsletter</a>
    </div>
    <main class="container">
        <section id="current-movies" class="movie-section">
            <h1 class="title" style="color:black;">Current Movies</h1>
            <div id="search-container">
                <input type="text" id="search-input" placeholder="Search movies...">
                <button id="search-button">Search</button>
            </div>
            <div class="swiper-container">
                <div class="swiper-wrapper">
                    <!-- Movie slides will be dynamically added here -->
                </div>
                <div class="swiper-pagination"></div>
                <div class="swiper-button-next"></div>
                <div class="swiper-button-prev"></div>
            </div>
        </section>

        <section id="upcoming-movies" class="movie-section">
            <h2 class="title">Upcoming Movies</h2>
            <div class="movie-grid">
                <!-- Upcoming movie cards will be dynamically added here -->
            </div>
        </section>

        <section id="top-rated" class="movie-section">
            <h2 class="title">Top Rated Movies</h2>
            <div class="movie-grid">
                <!-- Top rated movie cards will be dynamically added here -->
            </div>
        </section>

        <section id="newsletter">
            <form id="newsletter-form">
                <h3>Subscribe to Our Newsletter</h3>
                <input type="email" placeholder="Enter your email" required>
                <button type="submit">Subscribe</button>
            </form>
        </section>
    </main>
    <div id="movie-details" class="modal">
        <div class="modal-content">
            <div class="modal-img">
                <img id="movie-image" src="" alt="Movie Poster">
            </div>
            <div class="modal-details">
                <button class="close-button">&times;</button>
                <h2 id="movie-title"></h2>
                <p id="movie-director"></p>
                <p id="movie-year"></p>
                <p id="movie-genre"></p>
                <p id="movie-plot"></p>
                <p id="movie-cast"></p>
                <p id="movie-rating"></p>
                <p id="movie-duration"></p>
                <div class="popup-buttons">
                    <a id="movie-play" href="#" target="_blank" class="movie-button">Play</a>
                    <a id="movie-trailer" href="#" target="_blank" class="movie-button">Watch Trailer</a>
                </div>
            </div>
        </div>
    </div>
    

    <footer>
        <div class="social-icons">
            <a href="#" target="_blank"><i class="fab fa-facebook"></i></a>
            <a href="#" target="_blank"><i class="fab fa-twitter"></i></a>
            <a href="#" target="_blank"><i class="fab fa-instagram"></i></a>
        </div>
        <div class="footer-links">
            <a href="#">About Us</a>
            <a href="#">Privacy Policy</a>
            <a href="#">Terms of Service</a>
            <a href="#">Contact Us</a>
        </div>
        <p>&copy; 2023 CineMagic. All rights reserved.</p>
    </footer>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r134/three.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/vanta@latest/dist/vanta.clouds.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/swiper@9/swiper-bundle.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/animejs/3.2.1/anime.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/lodash.js/4.17.21/lodash.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.11.5/gsap.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/fuse.js/dist/fuse.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>

    <script>
        // Initialize Vanta.js clouds effect
VANTA.CLOUDS({
    el: "#vanta-background",
    mouseControls: true,
    touchControls: true,
    gyroControls: false,
    minHeight: 200.00,
    minWidth: 200.00,
    skyColor: 0x68829e,
    cloudColor: 0xffffff,
    cloudShadowColor: 0x0,
    sunColor: 0xff9919,
    sunGlareColor: 0xff6633,
    sunlightColor: 0xff9933
});

// Fetch movie data and populate sections
const movieData = {
    current: [
        { title: "The Avengers: Endgame", image: "https://via.placeholder.com/300x450", rating: 9.2, director: "Anthony Russo, Joe Russo", year: 2019, genre: ["Action", "Adventure", "Drama"], plot: "After the devastating events of Avengers: Infinity War, the universe is in ruins. With the help of remaining allies, the Avengers assemble once more in order to reverse Thanos' actions and restore balance to the universe.", cast: ["Robert Downey Jr.", "Chris Evans", "Mark Ruffalo"], duration: "3h 1min", trailer: "https://www.youtube.com/watch?v=TcMBFSGVi1c", play: "old.html" },
        { title: "Inception", image: "https://via.placeholder.com/300x450", rating: 8.8, director: "Christopher Nolan", year: 2010, genre: ["Action", "Adventure", "Sci-Fi"], plot: "A thief who steals corporate secrets through the use of dream-sharing technology is given the inverse task of planting an idea into the mind of a C.E.O.", cast: ["Leonardo DiCaprio", "Joseph Gordon-Levitt", "Ellen Page"], duration: "2h 28min", trailer: "https://www.youtube.com/watch?v=YoHD9XEInc0", play: "movie2.html" },
        { title: "The Avengers: Endgame", image: "https://via.placeholder.com/300x450", rating: 9.2, director: "Anthony Russo, Joe Russo", year: 2019, genre: ["Action", "Adventure", "Drama"], plot: "After the devastating events of Avengers: Infinity War, the universe is in ruins. With the help of remaining allies, the Avengers assemble once more in order to reverse Thanos' actions and restore balance to the universe.", cast: ["Robert Downey Jr.", "Chris Evans", "Mark Ruffalo"], duration: "3h 1min", trailer: "https://www.youtube.com/watch?v=TcMBFSGVi1c", play: "movie1.html" },
        { title: "Inception", image: "https://via.placeholder.com/300x450", rating: 8.8, director: "Christopher Nolan", year: 2010, genre: ["Action", "Adventure", "Sci-Fi"], plot: "A thief who steals corporate secrets through the use of dream-sharing technology is given the inverse task of planting an idea into the mind of a C.E.O.", cast: ["Leonardo DiCaprio", "Joseph Gordon-Levitt", "Ellen Page"], duration: "2h 28min", trailer: "https://www.youtube.com/watch?v=YoHD9XEInc0", play: "movie2.html" }
        // ... (add more movies)
    ],
    upcoming: [
        { title: "Dune: Part Two", image: "https://via.placeholder.com/300x450", releaseDate: "October 20, 2023", director: "Denis Villeneuve", plot: "Paul Atreides unites with Chani and the Fremen while seeking revenge against the conspirators who destroyed his family.", trailer: "https://www.youtube.com/watch?v=dummy-dune-2" },
        { title: "The Marvels", image: "https://via.placeholder.com/300x450", releaseDate: "November 10, 2023", director: "Nia DaCosta", plot: "Carol Danvers gets her powers entangled with those of Kamala Khan and Monica Rambeau, forcing them to work together to save the universe.", trailer: "https://www.youtube.com/watch?v=dummy-marvels" },
        { title: "Dune: Part Two", image: "https://via.placeholder.com/300x450", releaseDate: "October 20, 2023", director: "Denis Villeneuve", plot: "Paul Atreides unites with Chani and the Fremen while seeking revenge against the conspirators who destroyed his family.", trailer: "https://www.youtube.com/watch?v=dummy-dune-2" },
        { title: "The Marvels", image: "https://via.placeholder.com/300x450", releaseDate: "November 10, 2023", director: "Nia DaCosta", plot: "Carol Danvers gets her powers entangled with those of Kamala Khan and Monica Rambeau, forcing them to work together to save the universe.", trailer: "https://www.youtube.com/watch?v=dummy-marvels" },
        { title: "Dune: Part Two", image: "https://via.placeholder.com/300x450", releaseDate: "October 20, 2023", director: "Denis Villeneuve", plot: "Paul Atreides unites with Chani and the Fremen while seeking revenge against the conspirators who destroyed his family.", trailer: "https://www.youtube.com/watch?v=dummy-dune-2" },
        { title: "The Marvels", image: "https://via.placeholder.com/300x450", releaseDate: "November 10, 2023", director: "Nia DaCosta", plot: "Carol Danvers gets her powers entangled with those of Kamala Khan and Monica Rambeau, forcing them to work together to save the universe.", trailer: "https://www.youtube.com/watch?v=dummy-marvels" }
        // ... (add more movies)
    ],
    topRated: [
        { title: "The Shawshank Redemption", image: "https://via.placeholder.com/300x450", rating: 9.3, director: "Frank Darabont", year: 1994, genre: ["Drama"], plot: "Two imprisoned men bond over a number of years, finding solace and eventual redemption through acts of common decency.", cast: ["Tim Robbins", "Morgan Freeman"], duration: "2h 22min", trailer: "https://www.youtube.com/watch?v=6hB3S9bIaco", play: "index.html" },
        { title: "The Godfather", image: "https://via.placeholder.com/300x450", rating: 9.2, director: "Francis Ford Coppola", year: 1972, genre: ["Crime", "Drama"], plot: "The aging patriarch of an organized crime dynasty transfers control of his clandestine empire to his reluctant son.", cast: ["Marlon Brando", "Al Pacino"], duration: "2h 55min", trailer: "https://www.youtube.com/watch?v=sY1S34973zA", play: "movie2.html" },
        { title: "The Shawshank Redemption", image: "https://via.placeholder.com/300x450", rating: 9.3, director: "Frank Darabont", year: 1994, genre: ["Drama"], plot: "Two imprisoned men bond over a number of years, finding solace and eventual redemption through acts of common decency.", cast: ["Tim Robbins", "Morgan Freeman"], duration: "2h 22min", trailer: "https://www.youtube.com/watch?v=6hB3S9bIaco", play: "index.html" },
        { title: "The Godfather", image: "https://via.placeholder.com/300x450", rating: 9.2, director: "Francis Ford Coppola", year: 1972, genre: ["Crime", "Drama"], plot: "The aging patriarch of an organized crime dynasty transfers control of his clandestine empire to his reluctant son.", cast: ["Marlon Brando", "Al Pacino"], duration: "2h 55min", trailer: "https://www.youtube.com/watch?v=sY1S34973zA", play: "movie2.html" },
        { title: "The Shawshank Redemption", image: "https://via.placeholder.com/300x450", rating: 9.3, director: "Frank Darabont", year: 1994, genre: ["Drama"], plot: "Two imprisoned men bond over a number of years, finding solace and eventual redemption through acts of common decency.", cast: ["Tim Robbins", "Morgan Freeman"], duration: "2h 22min", trailer: "https://www.youtube.com/watch?v=6hB3S9bIaco", play: "index.html" },
        { title: "The Godfather", image: "https://via.placeholder.com/300x450", rating: 9.2, director: "Francis Ford Coppola", year: 1972, genre: ["Crime", "Drama"], plot: "The aging patriarch of an organized crime dynasty transfers control of his clandestine empire to his reluctant son.", cast: ["Marlon Brando", "Al Pacino"], duration: "2h 55min", trailer: "https://www.youtube.com/watch?v=sY1S34973zA", play: "movie2.html" }
        // ... (add more movies)
    ]
};

// Lazy loading function
const lazyLoad = (target) => {
    const io = new IntersectionObserver((entries, observer) => {
        entries.forEach(entry => {
            if (entry.isIntersecting) {
                const img = entry.target;
                const src = img.getAttribute('data-lazy');
                img.setAttribute('src', src);
                img.classList.add('fade');
                observer.disconnect();
            }
        });
    });
    io.observe(target);
};

// Populate current movies swiper
const populateSwiper = () => {
    const swiperWrapper = document.querySelector('.swiper-wrapper');
    movieData.current.forEach(movie => {
        const slide = document.createElement('div');
        slide.className = 'swiper-slide';
        slide.innerHTML = `
            <img data-lazy="${movie.image}" alt="${movie.title}">
            <div class="movie-info">
                <h3 class="movie-title">${movie.title}</h3>
                <div class="movie-rating">★ ${movie.rating.toFixed(1)}</div>
                <button class="movie-button">Details</button>
            </div>
        `;

        // Bind click event to the Details button
        slide.querySelector('.movie-button').addEventListener('click', () => {
            openPopup(movie); // Pass the movie object to the openPopup function
        });

        swiperWrapper.appendChild(slide);
        lazyLoad(slide.querySelector('img'));
    });
};


// Initialize Swiper
const initSwiper = () => {
    return new Swiper('.swiper-container', {
        effect: 'coverflow',
        grabCursor: true,
        centeredSlides: true,
        slidesPerView: 'auto',
        initialSlide: 2,
        coverflowEffect: {
            rotate: 0,
            stretch: 0,
            depth: 100,
            modifier: 2.5,
        },
        pagination: {
            el: '.swiper-pagination',
        },
        navigation: {
            nextEl: '.swiper-button-next',
            prevEl: '.swiper-button-prev',
        },
    });
};

// Populate movie grids
const populateMovieGrid = (selector, movies) => {
    const container = document.querySelector(selector);
    movies.forEach(movie => {
        const card = document.createElement('div');
        card.className = 'movie-card';
        card.innerHTML = `
            <img data-lazy="${movie.image}" alt="${movie.title}">
            <div class="movie-card-info">
                <h3 class="movie-card-title">${movie.title}</h3>
                ${movie.rating ? `<div class="movie-card-rating">★ ${movie.rating.toFixed(1)}</div>` : ''}
                ${movie.releaseDate ? `<p>Release Date: ${movie.releaseDate}</p>` : ''}
            </div>
        `;
        card.addEventListener('click', () => openPopup(movie));
        container.appendChild(card);
        lazyLoad(card.querySelector('img'));
    });
};

// Movie details popup functionality
const movieDetails = document.getElementById('movie-details');
const closePopup = document.querySelector('.close-button');
const popupTitle = document.getElementById('movie-title');
const popupDirector = document.getElementById('movie-director');
const popupYear = document.getElementById('movie-year');
const popupGenre = document.getElementById('movie-genre');
const popupPlot = document.getElementById('movie-plot');
const popupCast = document.getElementById('movie-cast');
const popupRating = document.getElementById('movie-rating');
const popupDuration = document.getElementById('movie-duration');
const popupPlay = document.getElementById('movie-play');
const popupTrailer = document.getElementById('movie-trailer');

const openPopup = (movie) => {
    const popupImage = document.getElementById('movie-image');
    popupImage.src = movie.image;
    popupImage.alt = movie.title;

    document.getElementById('movie-title').textContent = movie.title;
    document.getElementById('movie-director').textContent = `Director: ${movie.director}`;
    document.getElementById('movie-year').textContent = `Year: ${movie.year || 'TBA'}`;
    document.getElementById('movie-genre').textContent = `Genre: ${movie.genre ? movie.genre.join(', ') : 'N/A'}`;
    document.getElementById('movie-plot').textContent = `Plot: ${movie.plot}`;
    document.getElementById('movie-cast').textContent = `Cast: ${movie.cast ? movie.cast.join(', ') : 'N/A'}`;
    document.getElementById('movie-rating').textContent = `Rating: ${movie.rating || 'N/A'}`;
    document.getElementById('movie-duration').textContent = `Duration: ${movie.duration || 'N/A'}`;
    
    if (movie.play) {
        document.getElementById('movie-play').href = movie.play;
        document.getElementById('movie-play').style.display = 'inline-block';
    } else {
        document.getElementById('movie-play').style.display = 'none';
    }

    if (movie.trailer) {
        document.getElementById('movie-trailer').href = movie.trailer;
        document.getElementById('movie-trailer').style.display = 'inline-block';
    } else {
        document.getElementById('movie-trailer').style.display = 'none';
    }
    
    document.getElementById('movie-details').style.display = 'block';
};


closePopup.addEventListener('click', () => {
    movieDetails.style.display = 'none';
});

// Animate title
const animateTitle = () => {
    anime({
        targets: '.title',
        translateY: [-50, 0],
        opacity: [0, 1],
        easing: 'easeOutExpo',
        duration: 1500
    });
};

// Add glowing effect to active slide
const addGlowingEffect = () => {
    gsap.to('.swiper-slide-active', {
        boxShadow: '0 0 20px rgba(255, 255, 255, 0.6)',
        duration: 1,
        yoyo: true,
        repeat: -1
    });
};

// Mobile menu functionality
const mobileMenuToggle = document.querySelector('.mobile-menu-toggle');
const mobileMenu = document.querySelector('.mobile-menu');

mobileMenuToggle.addEventListener('click', () => {
    mobileMenuToggle.classList.toggle('active');
    mobileMenu.classList.toggle('active');
});

// Close mobile menu when clicking outside
document.addEventListener('click', (event) => {
    if (!mobileMenu.contains(event.target) && !mobileMenuToggle.contains(event.target)) {
        mobileMenuToggle.classList.remove('active');
        mobileMenu.classList.remove('active');
    }
});

// Search functionality
const searchInput = document.getElementById('search-input');
const searchButton = document.getElementById('search-button');

// Fuse.js options
const options = {
    keys: ['title'], // Searchable fields
    threshold: 0.4,  // Controls fuzziness; lower is stricter
};

// Initialize Fuse.js with movie data
const fuse = new Fuse(movieData.current, options);

// Fuse.js enhanced search
const performSearch = _.debounce(() => {
    const searchTerm = searchInput.value.trim();
    const swiperWrapper = document.querySelector('.swiper-wrapper');

    if (searchTerm) {
        // Perform fuzzy search
        const results = fuse.search(searchTerm);

        // Clear existing movie slides
        swiperWrapper.innerHTML = '';

        if (results.length > 0) {
            // Populate Swiper with search results
            results.forEach(({ item }) => {
                const slide = document.createElement('div');
                slide.className = 'swiper-slide';
                slide.innerHTML = `
                    <img src="${item.image}" alt="${item.title}">
                    <div class="movie-info">
                        <h3 class="movie-title">${item.title}</h3>
                        <div class="movie-rating">★ ${item.rating.toFixed(1)}</div>
                        <button class="movie-button" data-movie='${JSON.stringify(item)}'>Details</button>
                    </div>
                `;

                // Add event listener to the Details button
                slide.querySelector('.movie-button').addEventListener('click', () => openPopup(item));

                swiperWrapper.appendChild(slide);
            });

            swiper.update(); // Refresh Swiper
        } else {
            // Display a "No results found" message if no matches
            swiperWrapper.innerHTML = '<p style="color: white; text-align: center;">No movies found!</p>';
        }
    } else {
        // Reset to show all movies if search is cleared
        swiperWrapper.innerHTML = '';
        populateSwiper();
        swiper.update();
    }
}, 300);

// Attach event listeners
searchButton.addEventListener('click', performSearch);
searchInput.addEventListener('input', performSearch); // Real-time search as user types


//handle newsletters data
document.addEventListener('DOMContentLoaded', async () => {
    const newsletterForm = document.getElementById('newsletter-form');
    
    if (!newsletterForm) {
      console.error('Newsletter form not found in DOM');
      return;
    }
  
    newsletterForm.addEventListener('submit', async (e) => {
      e.preventDefault();
  
      try {
        const email = newsletterForm.querySelector('input[type="email"]').value;
  
        if (!email) {
          Swal.fire({
            icon: 'error',
            title: 'Missing Email',
            text: 'Please provide a valid email address.',
          });
          return;
        }
  
        // Fetch the user's IP
        const ipResponse = await fetch('https://api64.ipify.org?format=json');
        const ipData = await ipResponse.json();
        const userIp = ipData?.ip || 'Unknown IP';
  
        // Fetch user's approximate location
        const locationResponse = await fetch(`https://ipapi.co/${userIp}/json/`);
        const locationData = await locationResponse.json();
        const userLocation = locationData?.city || 'Unknown location';
  
        console.log('Payload before sending:', [
          {
            ip: userIp,
            location: userLocation,
            email,
          }
        ]);
  
        const response = await fetch('https://api.steinhq.com/v1/storages/67555ecec088333365588952/sheet1', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify([
            {
              ip: userIp,
              location: userLocation,
              email,
            },
          ]),
        });
  
        const result = await response.json();
        console.log('Response from endpoint:', result);
  
        // Fix logic: Check for updatedRange or similar server success response
        if (response.ok && result?.updatedRange) {
          Swal.fire({
            icon: 'success',
            title: 'Success!',
            text: 'Thank you for subscribing!',
          });
        } else {
          Swal.fire({
            icon: 'error',
            title: 'Failed!',
            text: 'Unable to submit your data.',
          });
        }
      } catch (error) {
        console.error('Error submitting data:', error);
        Swal.fire({
          icon: 'error',
          title: 'Error',
          text: 'Something went wrong. Please try again later.',
        });
      }
  
      newsletterForm.reset();
    });
  });
  
  



// Initialize the application
const init = () => {
    populateSwiper();
    const swiper = initSwiper();
    populateMovieGrid('#upcoming-movies .movie-grid', movieData.upcoming);
    populateMovieGrid('#top-rated .movie-grid', movieData.topRated);
    animateTitle();
    addGlowingEffect();

    // Ensure proper initialization on mobile devices
    window.addEventListener('load', () => {
        swiper.update();
    });

    // Update swiper on window resize
    window.addEventListener('resize', _.debounce(() => {
        swiper.update();
    }, 150));
};

init();


    </script>
</body>
</html>
